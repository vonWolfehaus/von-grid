var vg={VERSION:"0.1.1",PI:Math.PI,TAU:2*Math.PI,DEG_TO_RAD:.017453292519943,RAD_TO_DEG:57.29577951308232,SQRT3:Math.sqrt(3),TILE:"tile",ENT:"entity",STR:"structure",HEX:"hex",SQR:"square",ABS:"abstract"};!function(){var t=function(){this.obj=null,this.next=null,this.prev=null,this.free=!0},e=function(){this.first=null,this.last=null,this.length=0,this.objToNodeMap={},this.uniqueID=Date.now()+""+Math.floor(1e3*Math.random()),this.sortArray=[]};e.generateID=function(){return Math.random().toString(36).slice(2)+Date.now()},e.prototype={getNode:function(t){return this.objToNodeMap[t.uniqueID]},addNode:function(i){var s=new t;if(!i.uniqueID)try{i.uniqueID=e.generateID()}catch(n){return console.error("[LinkedList.addNode] obj passed is immutable: cannot attach necessary identifier"),null}return s.obj=i,s.free=!1,this.objToNodeMap[i.uniqueID]=s,s},swapObjects:function(t,e){this.objToNodeMap[t.obj.uniqueID]=null,this.objToNodeMap[e.uniqueID]=t,t.obj=e},add:function(t){var e=this.objToNodeMap[t.uniqueID];if(e){if(e.free===!1)return;e.obj=t,e.free=!1,e.next=null,e.prev=null}else e=this.addNode(t);if(this.first){if(!this.last)throw new Error("[LinkedList.add] No last in the list -- that shouldn't happen here");this.last.next=e,e.prev=this.last,this.last=e,e.next=null}else this.first=e,this.last=e,e.next=null,e.prev=null;this.length++,this.showDebug&&this.dump("after add")},has:function(t){return!!this.objToNodeMap[t.uniqueID]},moveUp:function(t){this.dump("before move up");var e=this.getNode(t);if(!e)throw"Oops, trying to move an object that isn't in the list";if(e.prev){var i=e.prev,s=i.prev;e==this.last&&(this.last=i);var n=e.next;s&&(s.next=e),e.next=i,e.prev=i.prev,i.next=n,i.prev=e,this.first==i&&(this.first=e)}},moveDown:function(t){var e=this.getNode(t);if(!e)throw"Oops, trying to move an object that isn't in the list";if(e.next){var i=e.next;this.moveUp(i.obj),this.last==i&&(this.last=e)}},sort:function(t){var e,i,s=this.sortArray,n=this.first;for(s.length=0;n;)s.push(n.obj),n=n.next;for(this.clear(),s.sort(t),i=s.length,e=0;i>e;e++)this.add(s[e])},remove:function(t){var e=this.getNode(t);return!e||e.free?!1:(e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),e.prev||(this.first=e.next),e.next||(this.last=e.prev),e.free=!0,e.prev=null,e.next=null,this.length--,!0)},shift:function(){var t=this.first;return 0===this.length?null:(t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),this.first=t.next,t.next||(this.last=null),t.free=!0,t.prev=null,t.next=null,this.length--,t.obj)},pop:function(){var t=this.last;return 0===this.length?null:(t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),this.last=t.prev,t.prev||(this.first=null),t.free=!0,t.prev=null,t.next=null,this.length--,t.obj)},concat:function(t){for(var e=t.first;e;)this.add(e.obj),e=e.next},clear:function(){for(var t=this.first;t;)t.free=!0,t=t.next;this.first=null,this.length=0},dispose:function(){for(var t=this.first;t;)t.obj=null,t=t.next;this.first=null,this.objToNodeMap=null},dump:function(t){console.log("===================="+t+"=====================");for(var e=this.first;e;)console.log("{"+e.obj.toString()+"} previous="+(e.prev?e.prev.obj:"NULL")),e=e.next();console.log("==================================="),console.log("Last: {"+(this.last?this.last.obj:"NULL")+"} First: {"+(this.first?this.first.obj:"NULL")+"}")}},e.prototype.constructor=e,vg.LinkedList=e}(),function(){var t=function(t,e,i,s,n){this._listener=e,this.isOnce=i,this.context=s,this.signal=t,this._priority=n||0};t.prototype={active:!0,params:null,execute:function(t){var e,i;return this.active&&this._listener&&(i=this.params?this.params.concat(t):t,e=this._listener.apply(this.context,i),this.isOnce&&this.detach()),e},detach:function(){return this.isBound()?this.signal.remove(this._listener,this.context):null},isBound:function(){return!!this.signal&&!!this._listener},_destroy:function(){delete this.signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this.isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},t.prototype.constructor=t;var e=function(){this._bindings=[],this._prevParams=null;var t=this;this.dispatch=function(){e.prototype.dispatch.apply(t,arguments)}};e.prototype={memorize:!1,_shouldPropagate:!0,active:!0,validateListener:function(t,e){if("function"!=typeof t)throw new Error("Signal: listener is a required param of {fn}() and should be a Function.".replace("{fn}",e))},_registerListener:function(e,i,s,n){var l,r=this._indexOfListener(e,s);if(-1!==r){if(l=this._bindings[r],l.isOnce!==i)throw new Error("You cannot add"+(i?"":"Once")+"() then add"+(i?"Once":"")+"() the same listener without removing the relationship first.")}else l=new t(this,e,i,s,n),this._addBinding(l);return this.memorize&&this._prevParams&&l.execute(this._prevParams),l},_addBinding:function(t){var e=this._bindings.length;do e--;while(this._bindings[e]&&t._priority<=this._bindings[e]._priority);this._bindings.splice(e+1,0,t)},_indexOfListener:function(t,e){for(var i,s=this._bindings.length;s--;)if(i=this._bindings[s],i._listener===t&&i.context===e)return s;return-1},has:function(t,e){return-1!==this._indexOfListener(t,e)},add:function(t,e,i){return this.validateListener(t,"add"),this._registerListener(t,!1,e,i)},addOnce:function(t,e,i){return this.validateListener(t,"addOnce"),this._registerListener(t,!0,e,i)},remove:function(t,e){this.validateListener(t,"remove");var i=this._indexOfListener(t,e);return-1!==i&&(this._bindings[i]._destroy(),this._bindings.splice(i,1)),t},removeAll:function(t){"undefined"==typeof t&&(t=null);for(var e=this._bindings.length;e--;)t?this._bindings[e].context===t&&(this._bindings[e]._destroy(),this._bindings.splice(e,1)):this._bindings[e]._destroy();t||(this._bindings.length=0)},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this.active){var t,e=Array.prototype.slice.call(arguments),i=this._bindings.length;if(this.memorize&&(this._prevParams=e),i){t=this._bindings.slice(),this._shouldPropagate=!0;do i--;while(t[i]&&this._shouldPropagate&&t[i].execute(e)!==!1)}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}},e.prototype.constructor=e,vg.Signal=e}(),vg.MouseCaster=function(t,e,i){this.down=!1,this.rightDown=!1,this.pickedObject=null,this.selectedObject=null,this.allHits=null,this.active=!0,this.shift=!1,this.ctrl=!1,this.wheel=0,this.position=new THREE.Vector3,this.screenPosition=new THREE.Vector2,this.signal=new vg.Signal,this.group=t,this._camera=e,this._raycaster=new THREE.Raycaster,this._preventDefault=!1,i=i||document,i.addEventListener("mousemove",this._onDocumentMouseMove.bind(this),!1),i.addEventListener("mousedown",this._onDocumentMouseDown.bind(this),!1),i.addEventListener("mouseup",this._onDocumentMouseUp.bind(this),!1),i.addEventListener("mousewheel",this._onMouseWheel.bind(this),!1),i.addEventListener("DOMMouseScroll",this._onMouseWheel.bind(this),!1)},vg.MouseCaster.OVER="over",vg.MouseCaster.OUT="out",vg.MouseCaster.DOWN="down",vg.MouseCaster.UP="up",vg.MouseCaster.CLICK="click",vg.MouseCaster.WHEEL="wheel",vg.MouseCaster.prototype={update:function(){if(this.active){this._raycaster.setFromCamera(this.screenPosition,this._camera);var t,e,i=this._raycaster.intersectObject(this.group,!0);i.length>0?(t=i[0],e=t.object.userData.structure,this.pickedObject!=e&&(this.pickedObject&&this.signal.dispatch(vg.MouseCaster.OUT,this.pickedObject),this.pickedObject=e,this.selectedObject=null,this.signal.dispatch(vg.MouseCaster.OVER,this.pickedObject)),this.position.copy(t.point),this.screenPosition.z=t.distance):(this.pickedObject&&this.signal.dispatch(vg.MouseCaster.OUT,this.pickedObject),this.pickedObject=null,this.selectedObject=null),this.allHits=i}},preventDefault:function(){this._preventDefault=!0},_onDocumentMouseDown:function(t){return t=t||window.event,t.preventDefault(),this._preventDefault?(this._preventDefault=!1,!1):(this.pickedObject&&(this.selectedObject=this.pickedObject),this.shift=t.shiftKey,this.ctrl=t.ctrlKey,this.down=1===t.which,this.rightDown=3===t.which,void this.signal.dispatch(vg.MouseCaster.DOWN,this.pickedObject))},_onDocumentMouseUp:function(t){return t.preventDefault(),this._preventDefault?(this._preventDefault=!1,!1):(this.shift=t.shiftKey,this.ctrl=t.ctrlKey,this.signal.dispatch(vg.MouseCaster.UP,this.pickedObject),this.selectedObject&&this.pickedObject&&this.selectedObject.uniqueID===this.pickedObject.uniqueID&&this.signal.dispatch(vg.MouseCaster.CLICK,this.pickedObject),this.down=1===t.which?!1:this.down,void(this.rightDown=3===t.which?!1:this.rightDown))},_onDocumentMouseMove:function(t){t.preventDefault(),this.screenPosition.x=t.clientX/window.innerWidth*2-1,this.screenPosition.y=2*-(t.clientY/window.innerHeight)+1},_onMouseWheel:function(t){if(this.active){t.preventDefault(),t.stopPropagation();var e=0;void 0!==t.wheelDelta?e=t.wheelDelta:void 0!==t.detail&&(e=-t.detail),e>0?this.wheel++:this.wheel--,this.signal.dispatch(vg.MouseCaster.WHEEL,this.wheel)}}},vg.MouseCaster.prototype.constructor=vg.MouseCaster,vg.util={clamp:function(t,e,i){return Math.max(e,Math.min(i,t))},sign:function(t){return t&&t/Math.abs(t)},random:function(t,e){return 1===arguments.length?Math.random()*t-.5*t:Math.random()*(e-t)+t},randomInt:function(t,e){return 1===arguments.length?Math.random()*t-.5*t|0:Math.random()*(e-t+1)+t|0},normalize:function(t,e,i){return(t-e)/(i-e)},getShortRotation:function(t){return t%=this.TAU,t>this.PI?t-=this.TAU:t<-this.PI&&(t+=this.TAU),t},generateID:function(){return Math.random().toString(36).slice(2)+Date.now()},isPlainObject:function(t){if("object"!=typeof t||t.nodeType||t===t.window)return!1;try{if(t.constructor&&!Object.prototype.hasOwnProperty.call(t.constructor.prototype,"isPrototypeOf"))return!1}catch(e){return!1}return!0},merge:function(t,e){var i=this,s=Array.isArray(e),n=s&&[]||{};return s?(t=t||[],n=n.concat(t),e.forEach(function(e,s){"undefined"==typeof n[s]?n[s]=e:i.isPlainObject(e)?n[s]=i.merge(t[s],e):-1===t.indexOf(e)&&n.push(e)}),n):(t&&i.isPlainObject(t)&&Object.keys(t).forEach(function(e){n[e]=t[e]}),Object.keys(e).forEach(function(s){e[s]&&i.isPlainObject(e[s])&&t[s]?n[s]=i.merge(t[s],e[s]):n[s]=e[s]}),n)},overwrite:function(t,e){for(var i in e)t.hasOwnProperty(i)&&e.hasOwnProperty(i)&&(t[i]=e[i])},now:function(){return window.nwf?window.nwf.system.Performance.elapsedTime:window.performance.now()},empty:function(t){for(;t.lastChild;)t.removeChild(t.lastChild)},radixSort:function(t,e,i,s){if(e=e||0,i=i||t.length,s=s||31,!(e>=i-1||0>s)){for(var n=e,l=i,r=1<<s;l>n;)if(t[n]&r){--l;var h=t[n];t[n]=t[l],t[l]=h}else++n;this.radixSort(t,e,l,s-1),this.radixSort(t,l,i,s-1)}},randomizeRGB:function(t,e){var i,s,n=t.split(","),l="rgb(";for(e=this.randomInt(e),i=0;3>i;i++)s=parseInt(n[i])+e,0>s?s=0:s>255&&(s=255),l+=s+",";return l=l.substring(0,l.length-1),l+=")"},getJSON:function(t){var e=new XMLHttpRequest,i="undefined"==typeof t.cache?!1:t.cache,s=i?t.url:t.url+"?t="+Math.floor(1e4*Math.random())+Date.now();e.onreadystatechange=function(){if(4===e.readyState&&200===e.status){var i=null;try{i=JSON.parse(e.responseText)}catch(s){return void console.warn("[Tools.getJSON] Error: "+t.url+" is not a json resource")}return void t.callback.call(t.scope||null,i)}},e.open("GET",s,!0),e.setRequestHeader("Accept","application/json"),e.setRequestHeader("Content-Type","application/json"),e.send("")}},vg.AStarFinder=function(t){t=t||{};var e={allowDiagonal:!1,heuristicFilter:null};e=vg.util.merge(e,t),this.allowDiagonal=e.allowDiagonal,this.heuristicFilter=e.heuristicFilter,this.list=new vg.LinkedList},vg.AStarFinder.prototype={findPath:function(t,e,i,s){var n,l,r,h,o,a;for(i=i||this.heuristicFilter,s.clearPath(),this.list.clear(),this.list.add(t);this.list.length>0;){if(this.list.sort(this.compare),n=this.list.shift(),n._visited=!0,n===e)return vg.PathUtil.backtrace(e);for(r=s.getNeighbors(n,this.allowDiagonal,i),o=0,a=r.length;a>o;o++)if(h=r[o],h.walkable&&(l=n._calcCost+s.distance(n,h),!h._visited||l<h._calcCost)){if(h._visited=!0,h._parent=n,h._calcCost=l,h._priority=l+s.distance(e,h),h===e)return vg.PathUtil.backtrace(e);this.list.add(h)}}return null},compare:function(t,e){return t._priority-e._priority}},vg.AStarFinder.prototype.constructor=vg.AStarFinder,vg.PathUtil={backtrace:function(t){for(var e=[t];t._parent;)t=t._parent,e.push(t);return e.reverse()},biBacktrace:function(t,e){var i=this.backtrace(t),s=this.backtrace(e);return i.concat(s.reverse())},pathLength:function(t){var e,i,s,n,l,r=0;for(e=1;e<t.length;++e)i=t[e-1],s=t[e],n=i[0]-s[0],l=i[1]-s[1],r+=Math.sqrt(n*n+l*l);return r},interpolate:function(t,e,i,s){var n,l,r,h,o,a,c=Math.abs,u=[];for(r=c(i-t),h=c(s-e),n=i>t?1:-1,l=s>e?1:-1,o=r-h;t!==i||e!==s;)u.push([t,e]),a=2*o,a>-h&&(o-=h,t+=n),r>a&&(o+=r,e+=l);return u},expandPath:function(t){var e,i,s,n,l,r,h=[],o=t.length;if(2>o)return h;for(l=0;o-1>l;++l)for(e=t[l],i=t[l+1],s=this.interpolate(e[0],e[1],i[0],i[1]),n=s.length,r=0;n-1>r;++r)h.push(s[r]);return h.push(t[o-1]),h},smoothenPath:function(t,e){var i,s,n,l,r,h,o,a,c,u,d,f,p=e.length,v=e[0][0],g=e[0][1],_=e[p-1][0],m=e[p-1][1];for(i=v,s=g,r=[[i,s]],o=2;p>o;++o){for(c=e[o],n=c[0],l=c[1],u=this.interpolate(i,s,n,l),f=!1,a=1;a<u.length;++a)if(d=u[a],!t.isWalkableAt(d[0],d[1])){f=!0;break}f&&(h=e[o-1],r.push(h),i=h[0],s=h[1])}return r.push([_,m]),r},compressPath:function(t){if(t.length<3)return t;var e,i,s,n,l,r,h=[],o=t[0][0],a=t[0][1],c=t[1][0],u=t[1][1],d=c-o,f=u-a;for(l=Math.sqrt(d*d+f*f),d/=l,f/=l,h.push([o,a]),r=2;r<t.length;r++)e=c,i=u,s=d,n=f,c=t[r][0],u=t[r][1],d=c-e,f=u-i,l=Math.sqrt(d*d+f*f),d/=l,f/=l,(d!==s||f!==n)&&h.push([e,i]);return h.push([c,u]),h}},vg.Board=function(t,e){if(!t)throw new Error("You must pass in a grid system for the board to use.");this.tileHeightStep=3,this.tiles=[],this.grid=null,this.finder=new vg.AStarFinder(e),this.group=new THREE.Object3D,this.tileGroup=null,this.setGrid(t)},vg.Board.prototype={constructor:vg.Board,setEntityOnTile:function(t,e){var i=this.grid.cellToPixel(e.cell);t.position.copy(i),t.position.y+=t.heightOffset||0,t.tile&&(t.tile.entity=null),t.tile=e,e.entity=t},addTile:function(t){var e=this.tiles.indexOf(t);-1===e&&(this.tiles.push(t),this.snapTileToGrid(t),t.position.y=t.cell.h*this.tileHeightStep,this.tileGroup.add(t.mesh),this.grid.add(t.cell),t.cell.tile=t)},removeTile:function(t){if(t){var e=this.tiles.indexOf(t);this.grid.remove(t.cell),-1!==e&&this.tiles.splice(e,1),this.tileGroup.remove(t.mesh),t.dispose()}},removeAllTiles:function(){if(this.tileGroup)for(var t=this.tileGroup.children,e=0;e<t.length;e++)this.tileGroup.remove(t[e])},getTileAtCell:function(t){var e=this.grid.cellToHash(t);return t.tile||("undefined"!=typeof this.grid.cells[e]?this.grid.cells[e].tile:null)},snapToGrid:function(t){var e=this.grid.pixelToCell(t);t.copy(this.grid.cellToPixel(e))},snapTileToGrid:function(t){if(t.cell)t.position.copy(this.grid.cellToPixel(t.cell));else{var e=this.grid.pixelToCell(t.position);t.position.copy(this.grid.cellToPixel(e))}return t},getRandomTile:function(){if(0===this.tiles.length)return null;var t=vg.util.randomInt(0,this.tiles.length-1);return this.tiles[t]},findPath:function(t,e,i){return this.finder.findPath(t.cell,e.cell,i,this.grid)},setGrid:function(t){this.group.remove(this.tileGroup),this.grid&&t!==this.grid&&(this.removeAllTiles(),this.tiles.forEach(function(t){this.grid.remove(t.cell),t.dispose()}.bind(this)),this.grid.dispose()),this.grid=t,this.tiles=[],this.tileGroup=new THREE.Object3D,this.group.add(this.tileGroup)},reset:function(){this.removeAllTiles(),this.tileGroup&&this.group.remove(this.tileGroup),this.tileGroup=new THREE.Object3D,this.group.add(this.tileGroup)}},vg.Cell=function(t,e,i,s){this.q=t||0,this.r=e||0,this.s=i||0,this.h=s||1,this.tile=null,this.userData={},this.materialId=0,this.walkable=!0,this._calcCost=0,this._priority=0,this._visited=!1,this._parent=null,this.uniqueID=vg.LinkedList.generateID()},vg.Cell.prototype={set:function(t,e,i){return this.q=t,this.r=e,this.s=i,this},copy:function(t){return this.q=t.q,this.r=t.r,this.s=t.s,this.h=t.h,this.tile=t.tile||null,this.userData=t.userData||{},this.walkable=t.walkable,this},add:function(t){return this.q+=t.q,this.r+=t.r,this.s+=t.s,this},equals:function(t){return this.q===t.q&&this.r===t.r&&this.s===t.s}},vg.Cell.prototype.constructor=vg.Cell,vg.HexGrid=function(t){t=t||{},this.type=vg.HEX,this.size=5,this.cellSize="undefined"==typeof t.cellSize?10:t.cellSize,this.cells={},this.numCells=0,this.updateCellSize(),this._directions=[new vg.Cell(1,-1,0),new vg.Cell(1,0,-1),new vg.Cell(0,1,-1),new vg.Cell(-1,1,0),new vg.Cell(-1,0,1),new vg.Cell(0,-1,1)],this._diagonals=[new vg.Cell(2,-1,-1),new vg.Cell(1,1,-2),new vg.Cell(-1,2,-1),new vg.Cell(-2,1,1),new vg.Cell(-1,-1,2),new vg.Cell(1,-2,1)],this._hashDelimeter=".",this._list=[],this._vec3=new THREE.Vector3,this._cel=new vg.Cell,this._conversionVec=new THREE.Vector3,this._geoCache=null,this._matCache=null},vg.HexGrid.TWO_THIRDS=2/3,vg.HexGrid.prototype={constructor:vg.HexGrid,cellToPixel:function(t){return this._vec3.x=t.q*this._cellWidth*.75,this._vec3.y=t.h,this._vec3.z=-((t.s-t.r)*this._cellLength*.5),this._vec3},pixelToCell:function(t){var e=t.x*(vg.HexGrid.TWO_THIRDS/this.cellSize),i=(-t.x/3+vg.SQRT3/3*t.z)/this.cellSize;return this._cel.set(e,i,-e-i),this._cubeRound(this._cel)},getCellAt:function(t){var e=t.x*(vg.HexGrid.TWO_THIRDS/this.cellSize),i=(-t.x/3+vg.SQRT3/3*t.z)/this.cellSize;return this._cel.set(e,i,-e-i),this._cubeRound(this._cel),this.cells[this.cellToHash(this._cel)]},getNeighbors:function(t,e,i){var s,n,l=this._directions.length;for(this._list.length=0,s=0;l>s;s++)this._cel.copy(t),this._cel.add(this._directions[s]),n=this.cells[this.cellToHash(this._cel)],!n||i&&!i(t,n)||this._list.push(n);if(e)for(s=0;l>s;s++)this._cel.copy(t),this._cel.add(this._diagonals[s]),n=this.cells[this.cellToHash(this._cel)],!n||i&&!i(t,n)||this._list.push(n);return this._list},getRandomCell:function(){var t,e=0,i=vg.util.randomInt(0,this.numCells);for(t in this.cells){if(e===i)return this.cells[t];e++}return this.cells[t]},cellToHash:function(t){return t.q+this._hashDelimeter+t.r+this._hashDelimeter+t.s},distance:function(t,e){var i=Math.max(Math.abs(t.q-e.q),Math.abs(t.r-e.r),Math.abs(t.s-e.s));return i+=e.h-t.h},updateCellSize:function(t){this.cellSize!==t&&(t=t||this.cellSize,this.cellSize=t,this._cellWidth=2*this.cellSize,this._cellLength=.5*vg.SQRT3*this._cellWidth)},clearPath:function(){var t,e;for(t in this.cells)e=this.cells[t],e._calcCost=0,e._priority=0,e._parent=null,e._visited=!1},traverse:function(t){var e;for(e in this.cells)t(this.cells[e])},generate:function(t){t=t||{},this.size="undefined"==typeof t.size?this.size:t.size,t.overwrite&&this.removeAll();var e,i,s,n;for(e=-this.size;e<this.size+1;e++)for(i=-this.size;i<this.size+1;i++)if(s=-e-i,Math.abs(e)<=this.size&&Math.abs(i)<=this.size&&Math.abs(s)<=this.size){if(this.cells[e+this._hashDelimeter+i+this._hashDelimeter+s])continue;n=new vg.Cell(e,i,s),this.add(n)}},add:function(t){var e=this.cellToHash(t);return this.cells[e]?this.cells[e]:(this.cells[e]=t,this.numCells++,t)},remove:function(t){var e=this.cellToHash(t);this.cells[e]&&(delete this.cells[e],this.numCells--)},removeAll:function(){var t,e;for(t in this.cells)this.cells.hasOwnProperty(t)&&(e=this.cells[t],e.userData=null,e.tile=null,e._parent=null,delete this.cells[t]);this.numCells=0,this.cells={}},dispose:function(){this.cells=null,this.numCells=0,this.cellShape=null,this.cellGeo.dispose(),this.cellGeo=null,this.cellShapeGeo.dispose(),this.cellShapeGeo=null,this._list=null,this._vec3=null,this._conversionVec=null,this._geoCache=null,this._matCache=null},load:function(t,e,i){var s=this;vg.util.getJSON({url:t,callback:function(t){s.fromJSON(t),e.call(i||null,t)},cache:!1,scope:s})},fromJSON:function(t){var e,i,s=t.cells;for(this.cells={},this.numCells=0,this.size=t.size,this.updateCellSize(t.cellSize),e=0;e<s.length;e++)i=new vg.Cell,i.copy(s[e]),this.add(i)},toJSON:function(){var t,e,i={size:this.size,cellSize:this.cellSize},s=[];for(e in this.cells)t=this.cells[e],s.push({q:t.q,r:t.r,s:t.s,h:t.h,walkable:t.walkable,userData:t.userData});return i.cells=s,i},_cubeRound:function(t){var e=Math.round(t.q),i=Math.round(t.r),s=Math.round(t.s),n=Math.abs(e-t.q),l=Math.abs(i-t.r),r=Math.abs(s-t.s);return n>l&&n>r?e=-i-s:l>r?i=-e-s:s=-e-i,this._cel.set(e,i,s)}},vg.SqrGrid=function(t){t=t||{},this.type=vg.SQR,this.size=5,this.cellSize="undefined"==typeof t.cellSize?10:t.cellSize,this.cells={},this.numCells=0,this.extrudeSettings=null,this.autogenerated=!1,this.updateCellSize(),this._hashDelimeter=".",this._directions=[new vg.Cell(1,0,0),new vg.Cell(0,-1,0),new vg.Cell(-1,0,0),new vg.Cell(0,1,0)],this._diagonals=[new vg.Cell(-1,-1,0),new vg.Cell(-1,1,0),new vg.Cell(1,1,0),new vg.Cell(1,-1,0)],this._list=[],this._vec3=new THREE.Vector3,this._cel=new vg.Cell,this._conversionVec=new THREE.Vector3,this._geoCache=null,this._matCache=null},vg.SqrGrid.prototype={constructor:vg.SqrGrid,cellToPixel:function(t){return this._vec3.x=t.q*this._fullCellSize,this._vec3.y=t.h,this._vec3.z=t.r*this._fullCellSize,this._vec3},pixelToCell:function(t){var e=Math.round(t.x/this._fullCellSize),i=Math.round(t.z/this._fullCellSize);return this._cel.set(e,i,0)},getCellAt:function(t){var e=Math.round(t.x/this._fullCellSize),i=Math.round(t.z/this._fullCellSize);return this._cel.set(e,i),this.cells[this.cellToHash(this._cel)]},getNeighbors:function(t,e,i){var s,n,l=this._directions.length;for(this._list.length=0,s=0;l>s;s++)this._cel.copy(t),this._cel.add(this._directions[s]),n=this.cells[this.cellToHash(this._cel)],!n||i&&!i(t,n)||this._list.push(n);if(e)for(s=0;l>s;s++)this._cel.copy(t),this._cel.add(this._diagonals[s]),n=this.cells[this.cellToHash(this._cel)],!n||i&&!i(t,n)||this._list.push(n);return this._list},getRandomCell:function(){var t,e=0,i=vg.util.randomInt(0,this.numCells);for(t in this.cells){if(e===i)return this.cells[t];e++}return this.cells[t]},cellToHash:function(t){return t.q+this._hashDelimeter+t.r},distance:function(t,e){var i=Math.max(Math.abs(t.q-e.q),Math.abs(t.r-e.r));return i+=e.h-t.h},updateCellSize:function(t){this.cellSize!==t&&(t=t||this.cellSize,this.cellSize=t,this._cellWidth=2*this.cellSize,this._cellLength=.5*vg.SQRT3*this._cellWidth,this.generateGeo())},clearPath:function(){var t,e;for(t in this.cells)e=this.cells[t],e._calcCost=0,e._priority=0,e._parent=null,e._visited=!1},traverse:function(t){var e;for(e in this.cells)t(this.cells[e])},add:function(t){var e=this.cellToHash(t);return this.cells[e]?this.cells[e]:(this.cells[e]=t,this.numCells++,t)},remove:function(t){var e=this.cellToHash(t);this.cells[e]&&(delete this.cells[e],this.numCells--)},removeAll:function(){var t,e;for(t in this.cells)this.cells.hasOwnProperty(t)&&(e=this.cells[t],e.userData=null,e.tile=null,e._parent=null,delete this.cells[t]);this.numCells=0,this.cells={}},dispose:function(){this.cells=null,this.numCells=0,this.cellShape=null,this.cellGeo.dispose(),this.cellGeo=null,this.cellShapeGeo.dispose(),this.cellShapeGeo=null,this._list=null,this._vec3=null,this._conversionVec=null,this._geoCache=null,this._matCache=null},load:function(t,e,i){vg.util.getJSON({url:t,callback:function(t){this.fromJSON(t),e.call(i||null,t)},cache:!1,scope:this})},fromJSON:function(t){var e,i,s=t.cells;for(this.cells={},this.numCells=0,this.size=t.size,this.updateCellSize(t.cellSize),e=0;e<s.length;e++)i=new vg.Cell,i.copy(s[e]),this.add(i)},toJSON:function(){var t,e,i={size:this.size,cellSize:this.cellSize},s=[];for(e in this.cells)t=this.cells[e],s.push({q:t.q,r:t.r,s:t.s,h:t.h,walkable:t.walkable,userData:t.userData});return i.cells=s,i}},vg.SqrGrid.prototype.constructor=vg.SqrGrid;
//# sourceMappingURL=von-grid.min.js.map
